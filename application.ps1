$applications = Get-WmiObject -class win32_product
$count=0

$outfile = "$pwd\application_vuln.csv"
Remove-Item $outfile -Force



foreach ($c in $applications){

$check = $applications[$count].Name+", "+$applications[$count].version
$check = $check -replace ' ','+'
$check
$url = "https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=$check"
$HTML = Invoke-WebRequest -Uri $url
$output = $HTML.Links | ForEach-Object -MemberName innertext | Select-String "CVE-"
foreach ($_ in $output) {
#writing out each member of the object as a string that can be utilised by PS
$CVE = $_

$url2 = "https://nvd.nist.gov/vuln/search/results?form_type=Basic&results_type=overview&query=$CVE"
$html2 = Invoke-WebRequest -Uri $url2
$output2 = $html2.ParsedHtml.all.tags("td") | ForEach-Object -MemberName innertext 

#Write-Host $CVE
#Write-Host $output2

 #custom object which exports data to a csv file for use external to this script.
[pscustomobject]@{

App_Name =  $applications[$count].Name
App_Version =$applications[$count].version
CVE = $cve
Comment = (@($output2) -join ',')

} | export-csv -NoTypeInformation -Path $outfile -Append
}
$count++

} >$null


